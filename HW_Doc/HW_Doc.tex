\documentclass{report}

\newcommand{\hmwkTitle}{The SHED: Hardware \& Control Unit}
\newcommand{\hmwkClass}{CSCI-453 Computer Architecture}
\newcommand{\hmwkAuthorName}{\textbf{Max Kipust, Drew Young}}

\usepackage[letterpaper,margin=0.5in,top=1in,bottom=1in]{geometry}
\usepackage{extramarks}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amsfonts}
\usepackage{tikz}
	\usetikzlibrary{positioning}
	\usetikzlibrary{calc}
\usepackage{circuitikz}
\usepackage{enumitem}
\usepackage{fancyhdr}
	\pagestyle{fancy}
	\lhead{\hmwkAuthorName}
	% \chead{\hmwkClass\ (\hmwkClassInstructor\ \hmwkClassTime): \hmwkTitle}
	\rhead{\firstxmark}
	\lfoot{\lastxmark}
	\cfoot{\thepage}

	\renewcommand{\headrulewidth}{0.4pt}
	\renewcommand{\footrulewidth}{0.4pt}
	\setlength{\headheight}{14.5pt}
\usepackage{fontspec}
	\setmainfont{Doulos SIL}
\usepackage{booktabs}
\usepackage{lscape}
\usepackage{longtable}
\usepackage{bytefield}
\usepackage{array}
\usepackage{hyperref}
	\hypersetup{
		pdftitle={\hmwkTitle},
		pdfauthor={\hmwkAuthorName}
	}

\setlength\parindent{0pt}

\begin{document}

\begin{titlepage}
	\renewcommand*{\thepage}{Title}

	\begin{center}
		\vspace{2in}
		\textmd{\textbf{\Huge \hmwkClass:\\ \hmwkTitle}}\\
		\vspace{3in}

		\hmwkAuthorName

		\vfill

		{\large \today}
	\end{center}
\end{titlepage}

\chapter{Hardware}

	\begin{landscape}
	\section{Diagram}

		\tikzset{
			ALU/.style={
				muxdemux,
				muxdemux def={
					Lh=5, Rh=2,
					inset Lh=2, inset Rh=0,
					w=3, inset w=1,
					NL=0, NR=0, NB=0
				}
			},
			-|/.style={
				to path={
					(\tikztostart) -| (\tikztotarget)
					\tikztonodes
				}
			},
			|-/.style={
				to path={
					(\tikztostart) |- (\tikztotarget)
					\tikztonodes
				}
			},
			|/.style={
				to path={
					(\tikztostart) -- (\tikztotarget -| \tikztostart)
					\tikztonodes
				}
			},
			--/.style={
				to path={
					(\tikztostart) -- (\tikztotarget |- \tikztostart)
					\tikztonodes
				}
			}
		}

		\begin{figure}[h]
			\centering
			\begin{tikzpicture}
				\node[draw,rectangle,anchor=west,minimum width=10cm](belt) at (0, 4) {Belt};

				\node[draw,rectangle,anchor=east,minimum width=3cm,minimum height=2.5cm](imem) at (-2, 2) {Instr Mem};
				\node[anchor=north east,inner sep=1mm] (imem data) at (imem.north east) {Data};
				\node[anchor=south east,inner sep=1mm] (imem addr) at (imem.south east) {Addr};

				\node[draw,rectangle,anchor=west] (ir) at (0, 3) {IR};
				\draw (imem data.east) to[->] (ir.west);

				\node[draw,rectangle,anchor=north] (imm) at ($(ir.south) + (0, -0.2)$) {Imm};
				\draw (ir.south) to[->] (imm.north);

				\node[ALU,anchor=west] (alu1) at (3, 0) {ALU1};

				\node[draw,rectangle,anchor=east](fp) at ($(alu1.top left)!1/5!(alu1.inset top left) + (-1, 0)$) {FP};
				\node[draw,rectangle,anchor=east](pc) at ($(alu1.top left)!4/5!(alu1.inset top left) + (-1, 0)$) {PC};
				\node[draw,rectangle,anchor=east](ra) at ($(pc.west) + (-0.5, -0.1)$) {RA};
				\node[draw,rectangle,anchor=east](rfp) at ($(fp.west) + (-0.5, 0)$) {RFP};

				\draw (pc.south) to +(0, -0.3) to[->, -|] (imem addr.south);
				\draw (fp.east) to +(0.5, 0) to[->, |-] ($(alu1.top left)!1/5!(alu1.inset top left)$);
				\draw (pc.east) to +(0.5, 0) to[->, |-] ($(alu1.top left)!4/5!(alu1.inset top left)$);
				\draw (belt.south -| {$(alu1.left) + (-0.4, 0)$})
					to[|] ($(fp.north) + (0, 0.5)$) to[crossing] +(0, -0.2)
					to[|] ($(fp.north) + (0, 0.3)$) to[crossing] +(0, -0.2)
					edge[->, |-] ($(alu1.top left)!2/5!(alu1.inset top left)$)
					edge[->, |-] ($(alu1.inset bottom left)!1/3!(alu1.bottom left)$);
				\draw (imm.east) -- (imm.east -| {$(alu1.left) + (-0.7, 0)$})
					to[|] ($(fp.north) + (0, 0.5)$) to[crossing] +(0, -0.2)
					to[|] ($(fp.north) + (0, 0.3)$) to[crossing] +(0, -0.2)
					edge[->, |-] ($(alu1.top left)!3/5!(alu1.inset top left)$)
					edge[->, |-] ($(alu1.inset bottom left)!2/3!(alu1.bottom left)$);
				\draw (alu1.right) to +(0.3, 0)
					edge[->, |] (belt.south)
					to[|-] ($(fp.north) + (0, 0.2)$) to[-|] ($(pc.north west) + (-0.3, 0)$)
					to[->, |-] ($(pc.west)+(0,0.1)$);

				\draw (ra.east) to[->] ($(pc.west) + (0, -0.1)$);
				\draw (rfp.east) to[--] ($(pc.west) + (-0.4, 0)$) to[crossing] +(0.2, 0) to[->] (fp.west);

				\node[ALU,anchor=west] (alu2) at (10, 0) {ALU2};

				\node[draw,rectangle,anchor=east](sp) at ($(alu2.top left)!1/2!(alu2.inset top left) + (-1, 0)$) {SP};

				\draw (sp) to[->] ($(alu2.top left)!1/2!(alu2.inset top left)$);
				\draw (alu2.right) to +(0.3, 0) to[|] ($(fp.north) + (0, 0.4)$) to[--] (sp.north)
					edge[->, -|] (sp.north)
					to[-|] ($(fp.north) + (0, 0.3)$) to[crossing] +(0, -0.2) to[->] (fp.north);
			\end{tikzpicture}
			\caption{Hardware Diagram}
		\end{figure}
	\end{landscape}

\chapter{RTL}

	\section{Fetch}

	\section{Instructions}

		\subsection{ALU Operations}
		\subsection{ALU Operations with Immediate}
		\subsection{Add with Carry}
		\subsection{Load}
		\subsection{Read Stack}
		\subsection{Store}
		\subsection{Write Stack}
		\subsection{Jump}
		\subsection{Long Jump}
		\subsection{Branch}
		\subsection{Call Part 1}
		\subsection{Long Call Part 1}
		\subsection{Call Part 2}
		\subsection{Return Part 1}
		\subsection{Return Part 2}
		\subsection{Allocate Stack}
		\subsection{Constant}
		\subsection{Load Upper Immediate}

\end{document}
